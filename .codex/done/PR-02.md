# PR-02.md (greentic-interfaces)
# Title: Introduce provider-core WIT world (schema-core) + bindings + wasmtime smoke tests

## Goal
Add a single, stable provider framework contract:
- `greentic:provider/schema-core@1.0.0`

This is the **only** provider protocol Greentic needs for messaging/secrets/events providers.

## Non-goals
- Do not remove existing domain-provider worlds yet (that happens later).
- Do not change runtime behavior in this PR (only contracts + bindings + examples).

## New WIT world (Option B)
World name: `schema-core`

Exports:
- `describe() -> list<u8>` : JSON ProviderManifest
- `validate-config(config_json: list<u8>) -> validation-result`
- `healthcheck() -> health-status`
- `invoke(op: string, input_json: list<u8>) -> invoke-result`

### JSON shapes (documented; not WIT-typed)
ProviderManifest JSON (minimum):
- `provider_type: string`
- `capabilities: string[]`
- `ops: string[]`
Optional:
- `config_schema_ref: string`
- `state_schema_ref: string`

## Tasks
1. **Add WIT package**
   - Create directory:
     - `wit/greentic/provider/schema-core@1.0.0/`
   - Add `package.wit` and `world.wit` (or equivalent layout you use)
2. **Regenerate bindings**
   - Ensure `crates/greentic-interfaces/build.rs` stages new package.
   - Ensure `bindings::greentic::provider::schema_core` (or similar) is generated.
3. **Expose feature flags**
   - `crates/greentic-interfaces-host`:
     - Add feature `provider-core-v1` exposing host-side bindings
   - `crates/greentic-interfaces-guest`:
     - Add feature `provider-core-v1` exposing guest-side bindings for wasm32-wasip2
4. **Wasmtime glue**
   - `crates/greentic-interfaces-wasmtime`:
     - Ensure bindgen discovers and generates module for provider-core
     - Add `Component::instantiate` helper if consistent with other worlds
5. **Examples**
   - Add `examples/provider-core-dummy` (wasm32-wasip2):
     - Implements provider-core
     - `describe` returns JSON with provider_type `example.dummy`
     - `validate-config` validates JSON parses and returns ok
     - `invoke("echo", input)` returns input unchanged
6. **Tests**
   - Add wasmtime smoke test:
     - Instantiate dummy provider component
     - Call `describe`, parse JSON
     - Call `validate-config`
     - Call `invoke("echo")`

## File checklist
- [ ] `wit/greentic/provider/schema-core@1.0.0/package.wit`
- [ ] `wit/greentic/provider/schema-core@1.0.0/world.wit`
- [ ] `crates/greentic-interfaces/build.rs` (ensure discovery includes new package)
- [ ] `crates/greentic-interfaces/src/lib.rs` (if you have module lists)
- [ ] `crates/greentic-interfaces-host/Cargo.toml` + modules
- [ ] `crates/greentic-interfaces-guest/Cargo.toml` + modules
- [ ] `crates/greentic-interfaces-wasmtime/*` (auto-generated glue + test)
- [ ] `examples/provider-core-dummy/*`
- [ ] `crates/greentic-interfaces-wasmtime/tests/provider_core_smoke.rs`

## Acceptance criteria
- New world exists and bindings compile for host + guest.
- Wasmtime smoke test passes.
- No existing worlds removed.

## Notes for Codex
- Follow existing WIT package naming conventions under `wit/greentic/*@*`.
- Keep WIT types minimal: use bytes for JSON payloads to avoid version churn.
