// SPDX-License-Identifier: MIT

package greentic:component@0.6.0;

/// Canonical CBOR payload type used across the 0.6.0 component surface.


/// Structured self-description for components.
interface component-descriptor {
  /// Stable component identity and version metadata (CBOR-encoded).
  get-component-info: func() -> list<u8>;

  /// Full self-description (inputs, outputs, config, capabilities) as CBOR.
  describe: func() -> list<u8>;
}

/// CBOR-encoded schema exposure for inputs, outputs, and configuration.
interface component-schema {
  /// Deterministic, hashable CBOR schema for inputs.
  input-schema: func() -> list<u8>;

  /// Deterministic, hashable CBOR schema for outputs.
  output-schema: func() -> list<u8>;

  /// Deterministic, hashable CBOR schema for configuration/state.
  config-schema: func() -> list<u8>;
}

/// Component execution surface (CBOR payloads only).
interface component-runtime {
  /// Output + state payload for a run invocation.
  record run-result {
    output: list<u8>,
    new-state: list<u8>,
  }

  /// Executes with CBOR input + state; returns CBOR output + new state.
  run: func(input: list<u8>, state: list<u8>) -> run-result;
}

/// QA surface for configuration and updates.
interface component-qa {
  /// QA interaction modes for component configuration.
  enum qa-mode {
    default,
    setup,
    update,
    remove,
  }

  /// Returns CBOR-encoded QA spec for the given mode.
  qa-spec: func(mode: qa-mode) -> list<u8>;

  /// Applies CBOR-encoded answers to produce/update configuration.
  apply-answers: func(mode: qa-mode, current-config: list<u8>, answers: list<u8>) -> list<u8>;
}

/// i18n is first-class for all human-facing fields.
interface component-i18n {
  /// Returns all i18n keys used by this component.
  i18n-keys: func() -> list<string>;
}

/// Component world for greentic component version 0.6.0.
/// Components export descriptor/qa/i18n/runtime; hosts call these exports.
/// Hosts provide only imported host services.
world component-v0-v6-v0 {
  export component-descriptor;
  export component-schema;
  export component-runtime;
  export component-qa;
  export component-i18n;
}
