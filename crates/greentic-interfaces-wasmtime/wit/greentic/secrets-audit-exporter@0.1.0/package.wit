// SPDX-License-Identifier: MIT

package greentic:secrets-audit-exporter@0.1.0;

use greentic:secrets-provider/types@0.1.0;

/// Audit export surface that never exposes secret values.
interface audit-exporter-api {
  use greentic:secrets-provider/types@0.1.0.{
    correlation,
    error,
    kv,
    secret-ref,
  };

  /// Audit event kinds emitted by providers.
  enum audit-kind {
    read,
    write,
    promote,
    rotate,
    delete,
    access-denied,
    policy-denied,
    other,
  }

  /// Structured audit event without secret payloads.
  record audit-event {
    kind: audit-kind,
    secret: secret-ref,
    version: option<string>,
    actor: option<string>,
    reason: option<string>,
    timestamp-ms: option<u64>,
    labels: list<kv>,
  }

  /// Export summary for a batch.
  record export-summary {
    accepted: u32,
    failed: u32,
  }

  /// Ships audit events to a configured sink.
  export-events: func(
    sink-cfg-json: string,
    events: list<audit-event>,
    ctx: correlation
  ) -> result<export-summary, error>;
}

world audit-exporter {
  export audit-exporter-api;
}
